#!/usr/bin/env ruby
# frozen_string_literal: true

# avoid rails overhead when booting the server and behave like the real app server
if ["s", "server"].include?(ARGV[0])
  require 'json'
  raise "No options supported, use puma directly" unless ARGV.size == 1
  ENV.replace(Bundler::ORIGINAL_ENV) if defined?(Bundler) # fix bundle exec rails s
  ENV["RAILS_LOG_TO_STDOUT"] ||= "1"
  ENV["PORT"] ||= "3000"
  exec *JSON.parse(File.read("Dockerfile")[/^CMD (.*)/, 1])
end

# start production console in sandbox mode, disable with --no-sandbox
if ENV["RAILS_ENV"] == "production" && ["c", "console"].include?(ARGV[0]) && !ARGV.include?("--no-sandbox")
  ARGV.push "--sandbox"
end

APP_PATH = File.expand_path('../config/application', __dir__)
require_relative '../config/boot'
require 'rails/commands'
